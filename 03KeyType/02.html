<html>
<script type="text/javascript" src="lib/jquery.min.js"></script>
<script type="text/javascript" src="lib/p5.min.js"></script>
<script type="text/javascript" src="lib/p5.dom.js"></script>

<script>

var offset = 0;
var offScreen;
var drawStr = '';

function setup() {
  var div = createDiv('');

  var select = createElement('select')
    .id('font-select')
    .parent(div);

  $(select.elt).change(function() {
    createImages(this.value);
  });

  createElement('option', 'Helvetica')
    .class('font-option')
    .parent(select);
  createElement('option', 'Georgia')
    .class('font-option')
    .parent(select);

  createCanvas(800, 400);
  background(0);

  createImages('Helvetica');
  
  offScreen = createGraphics(width, height)
    .id('off-screen')
    .style('display', 'block');
  
  updateOffScreen();
}

function draw() {
  background(0);

  var g = select('#off-screen');
  
  for (var i = 0; i < 24; i++) {
    for (var j = 0; j < 24; j++) {
      var x = (i + offset) * width / 24;
      var y = (j + 0.5) * height / 24;
      var c = offScreen.get(x * offScreen.width / width, y * offScreen.height / height);
      fill(c);
      ellipse(x, y, width / 24, height / 24);
      //rect(x, y, width / 24, height / 24);
    }
  }

  offset += 0.1;
  if (offset > 1.0) {
    offset = 0;
  }
}

function createImages(fontName) {

  //var fontName = selectAll('.font-option')[select('#font-select').elt.selectedIndex].value();

  for (var i = 32; i <= 126; i++) {
    textSize(200 * 0.9);
    textFont(fontName);
    var letter = char(i);
    var letterWidth = textWidth(letter);

    if (select('#' + letter)) {
      select('#' + letter).remove();
    }

    var g = createGraphics(letterWidth, 200);
    g.id(letter);
    g.background(0);
    g.fill(255);
    g.noStroke();
    //g.noSmooth();
    g.textSize(g.height * 0.9);
    g.textFont(fontName);
    g.textAlign(CENTER);
    g.text(letter, g.width / 2, g.height * 0.9 * 0.8);
    //g.style('display', 'inline'); // make hidden canvas visible
  }
}

function keyTyped() {
	/*
	if (keyCode === DELETE) {
		drawStr = drawStr.substr(0, drawStr.length - 1);
	}
	*/
  var code = unchar(key);
  if (code >= 32 && code <= 126) {
  	drawStr += key;
  	if (drawStr.length > 4) {
  		drawStr = drawStr.substring(1);
  	}
  	updateOffScreen();
  }
  return false; // prevent any default behavior
}

function updateOffScreen() {
	var x = 0;
  var g = offScreen;
  g.background(0);
	for (var i = 0; i < drawStr.length; i++) {
    var img = select('#' + drawStr.substr(i, 1));
    var drawWidth = img.elt.width / img.elt.height * height;
    
    g.image(img, x, 0, drawWidth, height);
    x += drawWidth;
	}
}

function drawImages(text) {
  background(0);
  var x = 0;
  for (var i = 0; i < text.length; i++) {
    var img = select('#' + text.substr(i, 1));
    image(img, x, 0)
    x += img.width;
  }
}

</script>
</html>
